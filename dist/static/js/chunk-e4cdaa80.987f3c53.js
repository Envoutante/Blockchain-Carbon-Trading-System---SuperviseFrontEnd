(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e4cdaa80"],{"07ac":function(t,e,a){var n=a("23e7"),i=a("6f53").values;n({target:"Object",stat:!0},{values:function(t){return i(t)}})},"3b17":function(t,e,a){},"6f53":function(t,e,a){var n=a("83ab"),i=a("df75"),r=a("fc6a"),s=a("d1e7").f,l=function(t){return function(e){var a,l=r(e),o=i(l),u=o.length,c=0,p=[];while(u>c)a=o[c++],n&&!s.call(l,a)||p.push(t?[a,l[a]]:l[a]);return p}};t.exports={entries:l(!0),values:l(!1)}},"77c4":function(t,e,a){"use strict";var n=a("b775");e["a"]={getBindDetail:function(t,e){return Object(n["a"])({url:"/audit/enterpriseBindDetail",method:"post",data:{token:t,enterpriseID:e}})},getBindList:function(){return Object(n["a"])({url:"/audit/enterpriseBindList",method:"get"})},getUserList:function(){return Object(n["a"])({url:"/audit/userList",method:"get"})},submitAuditResult:function(t,e,a,i){return Object(n["a"])({url:"/audit/verifyEnterprise",method:"post",data:{token:t,enterpriseIDList:e,auditStatus:a,auditOpinion:i}})},updateUserType:function(t,e,a){return Object(n["a"])({url:"/audit/changeUserType",method:"post",data:{token:t,userID:e,userType:a}})}}},"97ad":function(t,e,a){"use strict";var n=a("b775");e["a"]={getReportList:function(){return Object(n["a"])({url:"/caculate/reportList",method:"get"})},taskPublish:function(t,e,a,i,r){return Object(n["a"])({url:"/calculate/taskPublish",method:"post",data:{token:t,taskYear:e,taskBeginTime:a,taskEndTime:i,taskDescription:r}})},getReport:function(t,e){return Object(n["a"])({url:"/public/enterpriseReport",method:"post",data:{taskYear:t,enterpriseID:e}})},submitAuditResult:function(t,e,a,i,r){return Object(n["a"])({url:"/calculate/verifyReport",method:"post",data:{token:t,enterpriseID:e,auditStatus:a,auditOpinion:i,taskYear:r}})}}},c6c1:function(t,e,a){"use strict";a("3b17")},d80b:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"企业名"}},[a("el-input",{attrs:{size:"small",placeholder:"请输入企业名"},model:{value:t.searchForm.enterpriseName,callback:function(e){t.$set(t.searchForm,"enterpriseName",e)},expression:"searchForm.enterpriseName"}})],1),a("el-form-item",{attrs:{label:"企业组织机构代码"}},[a("el-input",{attrs:{size:"small",placeholder:"请输入企业组织机构代码"},model:{value:t.searchForm.enterpriseID,callback:function(e){t.$set(t.searchForm,"enterpriseID",e)},expression:"searchForm.enterpriseID"}})],1),a("el-form-item",[a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-search"},on:{click:t.handleSearch}},[t._v(" 查询 ")]),a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-refresh-left"},on:{click:t.handleReset}},[t._v("清空")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],attrs:{data:t.tableData.slice(t.pageBegin,t.pageEnd),"element-loading-text":"加载中",stripe:"",fit:"","highlight-current-row":"","default-sort":{prop:"taskYear",order:"descending"}}},[a("el-table-column",{attrs:{prop:"enterpriseID",label:"企业组织机构代码",align:"center",sortable:""}}),a("el-table-column",{attrs:{prop:"enterpriseName",label:"企业名",align:"center",sortable:""}}),a("el-table-column",{attrs:{prop:"enterpriseClass",label:"企业所处行业",align:"center",filters:[{text:"发电企业",value:"1"},{text:"电网企业",value:"2"},{text:"钢铁生产企业",value:"3"},{text:"化工生产企业",value:"4"},{text:"电解铝生产企业",value:"5"},{text:"镁冶炼企业",value:"6"},{text:"平板玻璃生产企业",value:"7"},{text:"水泥生产企业",value:"8"},{text:"陶瓷生产企业",value:"9"},{text:"民航企业",value:"10"}],"filter-method":t.filterCompany,"filter-placement":"bottom-end"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("companyFilter")(e.row.enterpriseClass))+" ")]}}])}),a("el-table-column",{attrs:{prop:"auditStatus",label:"审核状态",align:"center",filters:[{text:"审核通过",value:"PASS"},{text:"审核中",value:"AUDIT"},{text:"审核拒绝",value:"REFUSE"},{text:"尚未提交",value:"WAIT"}],"filter-method":t.filterStatus,"filter-placement":"bottom-end"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("a-tag",{attrs:{color:t._f("tagFilter")(e.row.auditStatus)}},[t._v(" "+t._s(t._f("statusFilter")(e.row.auditStatus))+" ")])]}}])}),a("el-table-column",{attrs:{prop:"submitTime",label:"填报时间",align:"center",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.dayjs(1e3*parseInt(e.row.submitTime)).format("YYYY[年]-MM[月]-DD[日]"))+" ")]}}])}),a("el-table-column",{attrs:{prop:"taskYear",label:"上报年份",align:"center",sortable:""}}),a("el-table-column",{attrs:{label:"操作",width:"200",align:"left"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("router-link",{staticStyle:{"margin-right":"10px"},attrs:{to:"/calculate/detail/"+e.row.taskYear+"/"+e.row.enterpriseID}},[a("el-link",{attrs:{type:"primary",underline:!1}},[t._v("详情")])],1),a("a-tooltip",{scopedSlots:t._u([{key:"title",fn:function(){return[t._v("点击即可发送邮件")]},proxy:!0}],null,!0)},["PASS"==e.row.auditStatus||"AUDIT"==e.row.auditStatus||e.row.enterpriseID==t.linkID&&e.row.taskYear.toString()==t.linkYear&&t.linkLoad?t._e():a("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(a){return t.sendEmail(e.row.enterpriseID,e.row.taskYear)}}},[t._v("邮件提醒")])],1),t.linkLoad&&e.row.enterpriseID==t.linkID&&e.row.taskYear.toString()==t.linkYear?a("el-link",{attrs:{type:"primary",underline:!1,disabled:""}},[t._v("发送中...")]):t._e()]}}])})],1),a("sonEmail",{ref:"son"}),a("div",{staticStyle:{display:"flex","justify-content":"right"}},[a("el-pagination",{staticStyle:{padding:"30px 0"},attrs:{"current-page":t.pageNum,"page-sizes":[10,20,30,50],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:this.reportListLength},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)},i=[],r=(a("4de4"),a("caad"),a("b64b"),a("d3b7"),a("07ac"),a("25f0"),a("2532"),a("97ad")),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div")},l=[],o=(a("bc3a"),a("77c4")),u=a("a78e"),c=a.n(u),p={data:function(){return{enterpriseID:"",taskYear:"",Emaildata:{}}},methods:{getInfo:function(t,e){this.enterpriseID=t,this.taskYear=e,this.getEmailData()},getEmailData:function(){var t=this;this.$parent.loadStatus(!0),this.axios({url:"https://mock.apifox.com/m1/2214773-0-default/getEmailData",method:"get",contentType:"application/json"}).then((function(e){t.Emaildata=e.data.data,t.updateInfo()}))},updateInfo:function(){var t=this;if(""==this.Emaildata.user_id)this.$message({message:"抱歉，暂时无法发送邮件，请稍后再试！",type:"warning"}),this.$parent.loadStatus(!1);else{var e=c.a.get("token");o["a"].getBindDetail(e,this.enterpriseID).then((function(e){t.Emaildata.template_params.to_enterpriseName=e.data.enterpriseName,t.Emaildata.template_params.to_taskYear=t.taskYear.toString(),t.Emaildata.template_params.to_email="1294352318@qq.com",console.log(t.Emaildata),t.sendEmail()}))}},sendEmail:function(){var t=this;this.axios({url:"https://api.emailjs.com/api/v1.0/email/send",method:"post",data:this.Emaildata,contentType:"application/json"}).then((function(e){t.$message({message:"邮件发送成功！",type:"success"}),t.$parent.loadStatus(!1),t.$parent.resetRow()})).catch((function(){t.$message({message:"邮件发送失败，请重试！",type:"error"}),t.$parent.loadStatus(!1),t.$parent.resetRow()}))}}},d=p,m=a("2877"),h=Object(m["a"])(d,s,l,!1,null,null,null),f=h.exports,g={components:{sonEmail:f},filters:{statusFilter:function(t){var e={PASS:"审核通过",AUDIT:"审核中",REFUSE:"审核拒绝",WAIT:"尚未提交"};return e[t]},tagFilter:function(t){var e={PASS:"green",AUDIT:"purple",REFUSE:"red",WAIT:"cyan"};return e[t]},companyFilter:function(t){var e={1:"发电企业",2:"电网企业",3:"钢铁生产企业",4:"化工生产企业",5:"电解铝生产企业",6:"镁冶炼企业",7:"平板玻璃生产企业",8:"水泥生产企业",9:"陶瓷生产企业",10:"民航企业"};return e[t]}},data:function(){return{tableData:{},reportList:{},reportListLength:void 0,listLoading:!0,dialogFormVisible:!1,formLabelWidth:"150px",pageBegin:0,pageEnd:0,pageSize:10,pageNum:0,searchForm:{enterpriseID:"",enterpriseName:""},linkLoad:!1,linkID:"",linkYear:""}},created:function(){this.fetchData(),this.pageEnd=this.pageSize},methods:{sendEmail:function(t,e){this.$refs.son.getInfo(t,e),this.linkID=t,this.linkYear=e.toString(),this.linkLoad=!0},loadStatus:function(t){this.linkLoad=t},resetRow:function(){this.linkID="",this.linkYear=""},handleSearch:function(){var t=this.searchForm,e=this.reportList,a=e.filter((function(e){return Object.values(t).every((function(a,n){return e[Object.keys(t)[n]].includes(a)}))}));this.tableData=a},handleReset:function(){this.tableData=this.reportList,this.searchForm.enterpriseID="",this.searchForm.enterpriseName=""},taskPublish:function(){var t=this,e="123";this.taskYear=(new Date).getFullYear();var a=parseInt(this.taskYear);r["a"].taskPublish(e,a,this.taskBeginTime/1e3,this.taskEndTime/1e3,this.taskDescription).then((function(e){t.$message({message:e.message,type:"success"}),t.taskFormVisible=!1,console.log(t.taskBeginTime/1e3)}))},fetchData:function(){var t=this;this.listLoading=!0,r["a"].getReportList().then((function(e){t.reportList=e.data.reportList,t.reportListLength=t.reportList.length,t.tableData=t.reportList,t.listLoading=!1}))},warning:function(){var t=this;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$message({type:"success",message:"删除成功!"})})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},formatter:function(t,e){return t.address},filterStatus:function(t,e){return e.auditStatus===t.toString()},filterCompany:function(t,e){return e.enterpriseClass===parseInt(t)},handleSizeChange:function(t){console.log("每页 ".concat(t," 条")),this.pageSize=t,this.pageEnd=this.pageBegin+this.pageSize},handleCurrentChange:function(t){console.log("当前页: ".concat(t)),this.pageNum=t,this.pageBegin=(this.pageNum-1)*this.pageSize,this.pageEnd=this.pageBegin+this.pageSize}}},b=g,k=(a("c6c1"),Object(m["a"])(b,n,i,!1,null,null,null));e["default"]=k.exports}}]);